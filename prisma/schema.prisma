generator client {
    provider = "prisma-client-js"
}

generator dbml {
    provider = "prisma-dbml-generator"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model User {
    id         String    @id @db.VarChar(20)
    pw         String    @db.VarChar(255)
    role       User_role @default(user)
    active     Boolean   @default(true)
    created_at DateTime  @default(now()) @db.DateTime(0)
    broom      Int       @default(0) @db.UnsignedInt
    Issue      Issue[]
    Post       Post[]
}

model Issue {
    id         Int         @id @default(autoincrement()) @db.UnsignedInt
    user       User?       @relation(fields: [user_id], references: [id])
    user_id    String      @db.VarChar(20)
    active     Boolean     @default(true)
    solved     Boolean     @default(false)
    title      String?     @db.VarChar(50)
    class      Int?
    body       String?     @db.Text
    created_at DateTime    @default(now()) @db.DateTime(0)
    user_lat   Decimal     @db.Decimal(16, 14)
    user_lng   Decimal     @db.Decimal(17, 14)
    Issue_img  Issue_img[]
}

model Detected_obj {
    id       Int           @id @default(autoincrement()) @db.UnsignedInt
    img      Issue_img?    @relation(fields: [img_id], references: [id])
    img_id   Int           @db.UnsignedInt
    class    Object_class? @relation(fields: [class_id], references: [id])
    class_id Int?          @db.UnsignedInt
    prob     Float         @default(0) @db.Float
}

model Issue_img {
    id           Int            @id @default(autoincrement()) @db.UnsignedInt
    issue        Issue?         @relation(fields: [issue_id], references: [id])
    issue_id     Int            @db.UnsignedInt
    org_name     String         @db.VarChar(255)
    src          String?        @db.VarChar(255)
    uploaded_at  DateTime       @default(now()) @db.DateTime(0)
    time         DateTime?      @db.DateTime(0)
    lat          Decimal        @default(0.00000000000000) @db.Decimal(16, 14)
    lng          Decimal        @default(0.00000000000000) @db.Decimal(17, 14)
    Detected_obj Detected_obj[]
}

model Post_img {
    id      Int   @id @default(autoincrement()) @db.UnsignedInt
    post    Post? @relation(fields: [post_id], references: [id])
    post_id Int   @db.UnsignedInt
}

model Post {
    id       Int        @id @default(autoincrement()) @db.UnsignedInt
    user     User?      @relation(fields: [user_id], references: [id])
    user_id  String     @db.VarChar(20)
    title    String
    category Category   @default(none)
    body     String?    @db.Text
    price    Int?       @db.UnsignedInt
    active   Boolean    @default(true)
    solved   Boolean    @default(false)
    Post_img Post_img[]
}

model Object_class {
    id           Int            @id @default(autoincrement()) @db.UnsignedInt
    name         String         @db.VarChar(255)
    Detected_obj Detected_obj[]
}

enum User_role {
    user
    admin
    test
}

enum Category {
    none
    quest
    trade
}
